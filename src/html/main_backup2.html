<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8" />
        <title>메인</title>
        <link rel="stylesheet" href="../css/common.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <style>
            .on {
                color: red;
            }
        </style>
        <script type="module">
            /* 기본설정 */
            // Import the functions you need from the SDKs you need
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
            import { addDoc, collection, deleteDoc, doc, getDocs, getFirestore, updateDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries

            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: 'AIzaSyDKmdt_1FzRNBhaWU5IDCUCNDehX6mFIrQ',
                authDomain: 'sparta-82b6a.firebaseapp.com',
                projectId: 'sparta-82b6a',
                storageBucket: 'sparta-82b6a.appspot.com',
                messagingSenderId: '471910514788',
                appId: '1:471910514788:web:60157c536b4fd2b0699f71',
                measurementId: 'G-6G83Z7ZF03',
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            const $form = $('#form');
            const $display = $('#display');
            /* 생성 */
            // 컬렉션 members 안에 새로운 document 생성
            $form.on('submit', async (e) => {
                e.preventDefault();
                const nameInput = $('#name');
                const pwdInput = $('#password');
                const textInput = $('#text');

                await addDoc(collection(db, 'guestbooks'), {
                    name: nameInput.val(),
                    pwd: pwdInput.val(),
                    text: textInput.val(),
                });

                alert('등록완료');

                window.location.reload();
            });
            /* 읽기 */
            let docs = await getDocs(collection(db, 'guestbooks'));
            console.log(docs);
            docs.forEach((doc) => {
                const { name, text, pwd } = doc.data();
                const { id } = doc;

                let temp_html = `
                    <div class='guestbook-container'>
                        <span class='blind'>${id}</span>
                        <p>이름 : ${name}</p>
                        <p>${text}</p>
                        <p>비밀번호 : ${pwd}</p>
                        <button class='update-button'>업데이트 버튼</button>
                        <button class='delete-button'>삭제 버튼</button>
                    </div>
                `;
                $display.append(temp_html);
            });

            /* 업데이트 */
            async function update(id, name, text) {
                const item = await doc(db, 'guestbooks', id);
                updateDoc(item, { name, text });
            }
            /* 삭제 */
            async function remove(id) {
                await deleteDoc(await doc(db, 'guestbooks', id));
                window.location.reload();
            }
            $('.delete-button').on('click', (e) => {
                const id = $(e.currentTarget).parent().find('.blind').text();
                remove(id);
            });
        </script>
    </head>
    <body>
        <!-- header -->
        <header>
            <h1>칠칠맞조</h1>
            <div class="btn-right" onclick="home()">
                <div class="icon icons-home"></div>
            </div>
        </header>
        <form id="form">
            <label for="name">이름</label>
            <input id="name" />
            <label for="password">비밀번호</label>
            <input id="password" type="password" />
            <label for="desc">방명록</label>
            <textarea id="text"></textarea>
            <button type="submit">제출</button>
        </form>
        <div id="display">
            <h2>방명록</h2>
        </div>
        <!-- contents -->
        <div class="container">
            <div class="btns-container">
                <!-- 아래와 같이 들어오고 선택된 버튼의 경우 aria-selected 속성이 true가 됩니다.
                    <div class="btn-box" aria-selected='false'>
                        <button class="btn">
                          <div class="bondee-img">
                            <img src="/" width="50" height="50" />
                          </div>
                          <div class="text">${name}</div>
                        </button>
                      </div>
                 -->
            </div>
            <div class="main-content-container">
                <!-- 팀 소개 컨테이너 , on class는 해당 컨테이너 보여주는 클래스
                  <div class="team-introduce-container on"></div> 
                    팀원 소개 컨테이너
                <div class="member-introduce-container" data-name="<팀원 이름>"></div> 
              -->
                <div class="team-introduce-container on">z</div>
                <div class="member-introduce-container" data-name="장예성">z</div>
                <div class="member-introduce-container" data-name="박가연">z</div>
                <div class="member-introduce-container" data-name="이진호">z</div>
                <div class="member-introduce-container" data-name="김지예">z</div>
                <div class="member-introduce-container" data-name="김건우">z</div>
            </div>
        </div>

        <!-- footer -->
        <div class="footer">
            <p>Copyright. we are chilchil</p>
        </div>

        <script src="../js/button.js"></script>
        <script src="../js/common.js"></script>
        <script>
            // 버튼 클릭 시 상세 페이지 추가
            // $(function () {
            //   $('.btn').click(function () {
            //     let contentHtml = `
            //       <div style="text-align: center">${$(this).text()}</div>
            //     `;
            //     $(this).after(contentHtml);
            //   });
            // });
        </script>
    </body>
</html>
